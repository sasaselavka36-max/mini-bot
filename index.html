<!DOCTYPE html>
<html>

<head>
    <title>Мини-Шахматы</title>
    <style>
        body {
            font-family: Arial;
            margin: 0;
            padding: 0;
            text-align: center;
            background: #f2f2f2;
        }

        #start,
        #rules,
        #game {
            display: none;
            padding: 20px;
        }

        button {
            font-size: 20px;
            padding: 15px 25px;
            margin: 10px;
            cursor: pointer;
        }

        table {
            border-collapse: collapse;
            margin: 20px auto;
        }

        td {
            width: 50px;
            height: 50px;
            text-align: center;
            vertical-align: middle;
            font-size: 35px;
            cursor: pointer;
        }

        .white {
            background: #eee;
        }

        .black {
            background: #999;
        }

        .selected {
            outline: 3px solid red;
        }
    </style>
</head>

<body>

    <div id="start">
        <h1>Мини-Шахматы</h1>
        <button onclick="showGame()">Играть</button>
        <button onclick="showRules()">Правила</button>
    </div>

    <div id="rules">
        <h2>Правила шахмат</h2>
        <p>Вы играете белыми. Пешки ходят только вперед, фигуры ходят по своим правилам. Цель: поставить шах и мат
            королю противника.</p>
        <button onclick="showStart()">Назад</button>
    </div>

    <div id="game">
        <h2>Игра</h2>
        <table id="board"></table>
        <button onclick="sendData()">Отправить состояние боту</button>
    </div>

    <script>
        // Telegram WebApp заглушка для ПК
        if (!window.Telegram) window.Telegram = { WebApp: { sendData: d => alert("Отправка боту: " + d) } };

        const start = document.getElementById('start');
        const rules = document.getElementById('rules');
        const gameDiv = document.getElementById('game');

        function showStart() { start.style.display = 'block'; rules.style.display = 'none'; gameDiv.style.display = 'none'; }
        function showRules() { start.style.display = 'none'; rules.style.display = 'block'; gameDiv.style.display = 'none'; }
        function showGame() { start.style.display = 'none'; rules.style.display = 'none'; gameDiv.style.display = 'block'; drawBoard(); }

        // Шахматная доска и фигуры
        let board = [
            ['♜', '♞', '♝', '♛', '♚', '♝', '♞', '♜'],
            ['♟', '♟', '♟', '♟', '♟', '♟', '♟', '♟'],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['♙', '♙', '♙', '♙', '♙', '♙', '♙', '♙'],
            ['♖', '♘', '♗', '♕', '♔', '♗', '♘', '♖']
        ];
        const white = ['♙', '♖', '♘', '♗', '♕', '♔'];
        const black = ['♟', '♜', '♞', '♝', '♛', '♚'];
        let selected = null;

        function drawBoard() {
            const table = document.getElementById('board');
            table.innerHTML = '';
            for (let i = 0; i < 8; i++) {
                const row = document.createElement('tr');
                for (let j = 0; j < 8; j++) {
                    const cell = document.createElement('td');
                    cell.textContent = board[i][j];
                    cell.className = (i + j) % 2 === 0 ? 'white' : 'black';
                    if (selected && selected[0] === i && selected[1] === j) cell.classList.add('selected');
                    cell.onclick = () => clickCell(i, j);
                    row.appendChild(cell);
                }
                table.appendChild(row);
            }
        }

        function clickCell(i, j) {
            const piece = board[i][j];
            if (selected) {
                // нельзя бить свои фигуры
                if (white.includes(piece)) { selected = [i, j]; drawBoard(); return; }
                board[i][j] = board[selected[0]][selected[1]];
                board[selected[0]][selected[1]] = '';
                selected = null;
                drawBoard();
                setTimeout(botMove, 300);
            } else if (white.includes(piece)) {
                selected = [i, j];
                drawBoard();
            }
        }

        function botMove() {
            // простой бот: случайная фигура и случайный ход на соседнюю клетку
            let moves = [];
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    if (black.includes(board[i][j])) {
                        [[1, 0], [-1, 0], [0, 1], [0, -1], [1, 1], [1, -1], [-1, 1], [-1, -1]].forEach(d => {
                            let x = i + d[0], y = j + d[1];
                            if (x >= 0 && x < 8 && y >= 0 && y < 8 && !black.includes(board[x][y])) moves.push({ from: [i, j], to: [x, y] });
                        });
                    }
                }
            }
            if (moves.length === 0) return;
            const move = moves[Math.

                floor(Math.random() * moves.length)];
            board[move.to[0]][move.to[1]] = board[move.from[0]][move.from[1]];
            board[move.from[0]][move.from[1]] = '';
            drawBoard();
        }

        function sendData() {
            Telegram.WebApp.sendData(JSON.stringify({ board }));
        }

        showStart();
    </script>
</body>

</html>
