<!DOCTYPE html>
<html>

<head>
    <title>–ú–∏–Ω–∏-–®–∞—Ö–º–∞—Ç—ã —Å –±–æ—Ç–æ–º</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            text-align: center;
            font-family: Arial;
        }

        table {
            border-collapse: collapse;
            margin: 20px auto;
        }

        td {
            width: 60px;
            height: 60px;
            text-align: center;
            vertical-align: middle;
            font-size: 40px;
            cursor: pointer;
        }

        .white {
            background-color: #eee;
        }

        .black {
            background-color: #999;
        }

        .selected {
            outline: 3px solid red;
        }
    </style>
</head>

<body>
    <h1>–®–∞—Ö–º–∞—Ç—ã –ø—Ä–æ—Ç–∏–≤ –±–æ—Ç–∞ ü§ñ</h1>
    <p>–í—ã –∏–≥—Ä–∞–µ—Ç–µ –±–µ–ª—ã–º–∏. –ö–ª–∏–∫ –Ω–∞ —Ñ–∏–≥—É—Ä—É, –∑–∞—Ç–µ–º –Ω–∞ –∫–ª–µ—Ç–∫—É, —á—Ç–æ–±—ã —Ö–æ–¥–∏—Ç—å.</p>
    <table id="board"></table>
    <button onclick="sendData()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç—É</button>

    <script>
        const startPosition = [
            ['‚ôú', '‚ôû', '‚ôù', '‚ôõ', '‚ôö', '‚ôù', '‚ôû', '‚ôú'],
            ['‚ôü', '‚ôü', '‚ôü', '‚ôü', '‚ôü', '‚ôü', '‚ôü', '‚ôü'],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['‚ôô', '‚ôô', '‚ôô', '‚ôô', '‚ôô', '‚ôô', '‚ôô', '‚ôô'],
            ['‚ôñ', '‚ôò', '‚ôó', '‚ôï', '‚ôî', '‚ôó', '‚ôò', '‚ôñ']
        ];

        let boardState = JSON.parse(JSON.stringify(startPosition));
        let selected = null;

        const whitePieces = ['‚ôô', '‚ôñ', '‚ôò', '‚ôó', '‚ôï', '‚ôî'];
        const blackPieces = ['‚ôü', '‚ôú', '‚ôû', '‚ôù', '‚ôõ', '‚ôö'];

        function drawBoard() {
            const table = document.getElementById('board');
            table.innerHTML = '';
            for (let i = 0; i < 8; i++) {
                const row = document.createElement('tr');
                for (let j = 0; j < 8; j++) {
                    const cell = document.createElement('td');
                    cell.textContent = boardState[i][j];
                    cell.className = ((i + j) % 2 === 0) ? 'white' : 'black';
                    cell.onclick = () => handleClick(i, j, cell);
                    if (selected && selected[0] === i && selected[1] === j) cell.classList.add('selected');
                    row.appendChild(cell);
                }
                table.appendChild(row);
            }
        }

        function handleClick(i, j) {
            if (selected) {
                // –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –Ω–µ –±—å–µ–º —Å–≤–æ–∏ —Ñ–∏–≥—É—Ä—ã
                if (whitePieces.includes(boardState[i][j])) {
                    selected = [i, j];
                    drawBoard();
                    return;
                }

                // –ø–µ—Ä–µ–¥–≤–∏–≥–∞–µ–º —Ñ–∏–≥—É—Ä—É –∏–≥—Ä–æ–∫–∞
                boardState[i][j] = boardState[selected[0]][selected[1]];
                boardState[selected[0]][selected[1]] = '';
                selected = null;
                drawBoard();

                // —Ö–æ–¥ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à–æ–π —Ç–∞–π–º–∞—É—Ç
                setTimeout(botMove, 500);
            } else if (whitePieces.includes(boardState[i][j])) {
                selected = [i, j];
                drawBoard();
            }
        }

        function botMove() {
            // —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–Ω—ã—Ö —Ñ–∏–≥—É—Ä
            let moves = [];
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    if (blackPieces.includes(boardState[i][j])) {
                        // –±–æ—Ç –º–æ–∂–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è –Ω–∞ –ª—é–±—É—é –ø—É—Å—Ç—É—é –∏–ª–∏ —Å –±–µ–ª–æ–π —Ñ–∏–≥—É—Ä–æ–π —Ä—è–¥–æ–º (–ø—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞)
                        let dirs = [[1, 0], [-1, 0], [0, 1], [0, -1], [1, 1], [-1, -1], [1, -1], [-1, 1]]; // –ø—Ä–æ—Å—Ç–∞—è 8-–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
                        dirs.forEach(d => {
                            let x = i + d[0], y = j + d[1];
                            if (x >= 0 && x < 8 && y >= 0 && y < 8 && !blackPieces.includes(boardState[x][y])) {
                                moves.push({ from: [i, j], to: [x, y] });
                            }
                        });
                    }
                }
            }
            if (moves.length === 0) return; // –±–æ—Ç –Ω–µ –º–æ–∂–µ—Ç —Ö–æ–¥–∏—Ç—å
            const move = moves[Math.floor(Math.random() * moves.length)];
            boardState[move.to[0]][move.to[1]] = boardState[move.from[0]][move.from[1]];
            boardState[move.from[0]][move.from[1]] = '';
            drawBoard();
        }

        function sendData() {
            Telegram.WebApp.sendData(JSON.stringify({ board: boardState }));
        }

        drawBoard();
    </script>
</body>

</html>
